DROP TABLE FICHIERS_UTILISATEURS;
GO
DROP TABLE FICHIERS;
GO
DROP TABLE FONCTIONS;
GO
DROP TABLE PROJETS;
GO
DROP TABLE TYPES;
GO
DROP TABLE UTILISATEURS;
GO
DROP TABLE POLES;
GO
DROP TABLE EXTENSIONS;
GO


CREATE TABLE [TYPES] (
  [id] int IDENTITY (1,1) NOT NULL
, [nom] nvarchar(100) NOT NULL
);
GO
ALTER TABLE [TYPES] ADD CONSTRAINT [PK_TYPES] PRIMARY KEY ([id]);
GO

CREATE TABLE [EXTENSIONS] (
  [id] int IDENTITY (1,1) NOT NULL
, [id_type] int NOT NULL
, [nom] nvarchar(100) NOT NULL
);
GO
ALTER TABLE [EXTENSIONS] ADD CONSTRAINT [PK_EXTENSIONS] PRIMARY KEY ([id]);
GO
ALTER TABLE [EXTENSIONS] ADD CONSTRAINT [FK_TYPES] FOREIGN KEY ([id_type]) REFERENCES TYPES(id);
GO

CREATE TABLE [POLES] (
  [id] int IDENTITY (1,1) NOT NULL
, [nom] nvarchar(100) NOT NULL
);
GO
ALTER TABLE [POLES] ADD CONSTRAINT [PK_POLES] PRIMARY KEY ([id]);
GO

CREATE TABLE [UTILISATEURS] (
  [id] int IDENTITY (1,1) NOT NULL
, [nom] nvarchar(100) NOT NULL
);
GO
ALTER TABLE [UTILISATEURS] ADD CONSTRAINT [PK_UTILISATEURS] PRIMARY KEY ([id]);
GO

CREATE TABLE [PROJETS] (
  [id] int IDENTITY (1,1) NOT NULL
, [id_pole] int NOT NULL
, [nom] nvarchar(100) NOT NULL
);
GO
ALTER TABLE [PROJETS] ADD CONSTRAINT [PK_PROJETS] PRIMARY KEY ([id]);
GO
ALTER TABLE [PROJETS] ADD CONSTRAINT [FK_POLES] FOREIGN KEY ([id_pole]) REFERENCES POLES (id);
GO

CREATE TABLE [FONCTIONS] (
  [id] int IDENTITY (1,1) NOT NULL
, [id_projet] int NOT NULL
, [nom] nvarchar(100) NOT NULL
);
GO
ALTER TABLE [FONCTIONS] ADD CONSTRAINT [PK_FONCTIONS] PRIMARY KEY ([id]);
GO
ALTER TABLE [FONCTIONS] ADD CONSTRAINT [FK_PROJETS] FOREIGN KEY ([id_projet]) REFERENCES PROJETS (id);
GO

CREATE TABLE [FICHIERS] (
  [id] bigint IDENTITY (1,1) NOT NULL
, [id_extension] int NOT NULL
, [id_fonction] int NOT NULL
, [nom] nvarchar(100) NOT NULL
);
GO
ALTER TABLE [FICHIERS] ADD CONSTRAINT [PK_FICHIERS] PRIMARY KEY ([id]);
GO
ALTER TABLE [FICHIERS] ADD CONSTRAINT [FK_EXTENSIONS] FOREIGN KEY ([id_extension]) REFERENCES EXTENSIONS (id);
GO
ALTER TABLE [FICHIERS] ADD CONSTRAINT [FK_FONCTIONS] FOREIGN KEY ([id_fonction]) REFERENCES FONCTIONS (id);
GO

CREATE TABLE [FICHIERS_UTILISATEURS] (
  [id] int IDENTITY (1,1) NOT NULL
, [id_fichier] bigint NOT NULL
, [id_utilisateur] int NOT NULL
);
GO
ALTER TABLE [FICHIERS_UTILISATEURS] ADD CONSTRAINT [PK_FICHIERS_UTILISATEURS] PRIMARY KEY ([id]);
GO
ALTER TABLE [FICHIERS_UTILISATEURS] ADD CONSTRAINT [FK_FICHIERS] FOREIGN KEY ([id_fichier]) REFERENCES FICHIERS (id);
GO
ALTER TABLE [FICHIERS_UTILISATEURS] ADD CONSTRAINT [FK_UTILISATEURS] FOREIGN KEY ([id_utilisateur]) REFERENCES UTILISATEURS (id);
GO



#########TEST
INSERT INTO [POLES] (nom) VALUES('PO1');
GO

INSERT INTO [PROJETS] ([id_pole],[nom]) VALUES (1,'PR1');
GO

INSERT INTO [FONCTIONS] ([id_projet],[nom]) VALUES (1,'FO1');
GO

INSERT INTO [EXTENSIONS] ([nom]) VALUES ('EX1');
GO

INSERT INTO [FICHIERS] ([id_extension],[id_fonction],[nom]) VALUES (1,1,'a');
GO

INSERT INTO [UTILISATEURS] ([nom]) VALUES ('UT1');
GO

INSERT INTO [FICHIERS_UTILISATEURS] ([id_fichier],[id_utilisateur]) VALUES (1);
GO


#########DELETE
DELETE FROM [EXTENSIONS_TYPES]
WHERE id = 1;
GO
ALTER TABLE [EXTENSIONS_TYPES]ALTER COLUMN [id] IDENTITY (1,1)
GO
DELETE FROM [FICHIERS_UTILISATEURS]
WHERE id = 1 or id = 2;
GO
ALTER TABLE [FICHIERS_UTILISATEURS]ALTER COLUMN [id] IDENTITY (1,1)
GO
DELETE FROM [FICHIERS]
WHERE id = 2;
GO
ALTER TABLE [FICHIERS]ALTER COLUMN [id] IDENTITY (1,1)
GO
DELETE FROM [FONCTIONS]
WHERE id = 2;
GO
ALTER TABLE [FONCTIONS]ALTER COLUMN [id] IDENTITY (1,1)
GO
DELETE FROM [PROJETS]
WHERE id = 2;
GO
ALTER TABLE [PROJETS]ALTER COLUMN [id] IDENTITY (1,1)
GO
DELETE FROM [TYPES]
WHERE id = 1;
GO
ALTER TABLE [TYPES]ALTER COLUMN [id] IDENTITY (1,1)
GO
DELETE FROM [UTILISATEURS]
WHERE id = 1 or id = 2;
GO
ALTER TABLE [UTILISATEURS]ALTER COLUMN [id] IDENTITY (1,1)
GO
DELETE FROM [POLES]
WHERE id = 2;
GO
ALTER TABLE [POLES]ALTER COLUMN [id] IDENTITY (1,1)
GO
DELETE FROM [EXTENSIONS]
WHERE id = 1;
GO
ALTER TABLE [EXTENSIONS] ALTER COLUMN [id] IDENTITY (1,1)
GO